# PMS Integration Layer

HeyConcierge PMS integrations — syncs properties, bookings, and guests from external Property Management Systems.

## Architecture

```
modules/pms/
├── types.ts          — Shared types (Property, Booking, Guest, PmsProvider)
├── base-provider.ts  — Base class with HTTP client, rate limiting, error handling
├── index.ts          — Factory + re-exports
├── sync-service.ts   — Orchestrator: syncs PMS → Supabase
├── hostaway.ts       — Hostaway integration
├── smoobu.ts         — Smoobu integration
├── lodgify.ts        — Lodgify integration
├── guesty.ts         — Guesty integration
└── beds24.ts         — Beds24 integration

app/api/pms/
├── connect/route.ts              — POST/DELETE: connect/disconnect PMS
└── [provider]/webhook/route.ts   — POST: receive real-time updates

supabase/migrations/
└── 007_pms_integration.sql       — Tables: pms_connections, pms_property_mappings, pms_sync_log
```

## Integrations

| Provider | Auth | Status | Priority | Notes |
|----------|------|--------|----------|-------|
| **Hostaway** | OAuth2 (client_credentials) | ✅ Ready | 1 | Requires partner approval. 15 req/10s rate limit |
| **Smoobu** | API Key | ✅ Ready | 2 | Get key from Settings → Developer. OAuth for partners |
| **Lodgify** | API Key (X-ApiKey) | ✅ Ready | 3 | Key from account settings |
| **Guesty** | OAuth2 (client_credentials) | ✅ Ready | 4 | Requires API partner application |
| **Beds24** | Token (invite code → refresh token) | ✅ Ready | 5 | Invite code generated by property owner |

## Usage

### Connect a PMS

```bash
POST /api/pms/connect
{
  "organizationId": "uuid",
  "provider": "hostaway",
  "clientId": "...",
  "clientSecret": "..."
}
```

### Programmatic sync

```typescript
import { PmsSyncService } from '@/modules/pms/sync-service';

const sync = new PmsSyncService();
const results = await sync.syncConnection('connection-uuid');
```

### Create provider directly

```typescript
import { createProvider } from '@/modules/pms';

const provider = createProvider({
  provider: 'smoobu',
  apiKey: process.env.SMOOBU_API_KEY,
});

const properties = await provider.syncProperties();
```

## Environment Variables

```env
# Hostaway
HOSTAWAY_ACCOUNT_ID=
HOSTAWAY_CLIENT_ID=
HOSTAWAY_CLIENT_SECRET=

# Smoobu
SMOOBU_API_KEY=

# Lodgify
LODGIFY_API_KEY=

# Guesty
GUESTY_CLIENT_ID=
GUESTY_CLIENT_SECRET=

# Beds24
BEDS24_TOKEN=
BEDS24_REFRESH_TOKEN=
```

## Webhook Setup

Each provider has a webhook endpoint at `/api/pms/[provider]/webhook`.

- **Hostaway**: Configure webhook URL in Hostaway dashboard → Settings → API → Webhooks
- **Smoobu**: Settings → Developer → Webhook URL
- **Lodgify**: Contact Lodgify support for webhook access
- **Guesty**: Dashboard → Marketplace → Webhooks
- **Beds24**: Settings → Properties → Access → Booking Webhook

## Priority Roadmap

1. **Hostaway** — Most common PMS for vacation rentals in Nordics
2. **Smoobu** — Popular in Europe, simple API
3. **Lodgify** — Growing user base, straightforward REST API
4. **Guesty** — Enterprise tier, requires partner approval
5. **Beds24** — Niche but solid, token-based auth
